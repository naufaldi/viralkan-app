# Pre-push hook: Build verification for ALL packages
# This ensures every push has working code, regardless of branch
#
# We run in the repository root where turbo.json is located

echo "üîç Running pre-push build verification for ALL packages..."

# Build ALL packages to ensure complete verification
# Note: We don't use --affected here because:
# 1. We want to verify everything on main branch pushes
# 2. CI/CD needs full verification
# 3. Only building affected packages can miss integration issues
bun run turbo run build

# Capture the exit code
BUILD_EXIT_CODE=$?

if [ $BUILD_EXIT_CODE -eq 0 ]; then
  echo "‚úÖ Build verification passed for all packages!"
else
  echo "‚ùå Build verification failed!"
  echo "Please fix the build errors before pushing."
  echo ""
  echo "Tip: Run 'bun run build' locally to see detailed errors"
  exit $BUILD_EXIT_CODE
fi
